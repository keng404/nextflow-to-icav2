# nextflow-to-icav2
R-based helper scripts to generate XML files and modifications to NF scripts for ICAv2 compatiblity.
This is meant to be a developer tool to help them develop Nextflow pipelines that will run successfully on ICA

Nextflow workflows on ICAv2 are orchestrated by kubernetes require an XML file 
- containing data inputs (i.e. files + folders) and other parameters for parameters to properly be passed from ICA to your Nextflow workflows
- processes will need to contain a reference to a container --- a Docker image that will run that specific process
- processes will need a  ```pod annotation``` specified for ICA to know what instance type to run the process.
  - A table of instance types and the associated CPU + Memory specs can be found [here](https://illumina.gitbook.io/ica/project/p-flow/f-pipelines#compute-types)  

These scripts have been made to be compatible with [nf-core](https://github.com/nf-core) workflows

**DSL2 compatibility is still in developement**

# To generate an XML file from nf-core pipeline
```bash
Rscript nf-core.json_to_params_xml.R --json {PATH_TO_SCHEMA_JSON}
```
- A Nextflow schema JSON is generated by nf-core's python library nf-core
- nf-core can be installed via a ```pip install nf-core``` command
```bash
nf-core schema build -d {PATH_NF-CORE_DIR}
```

# [STILL IN DEVELOPMENT]: To generate an XML file and edits to Nextflow script, use the following template
```bash
Rscript  nf-core.ica_mod_nf_script.R --nf-script {MAIN_NF_SCRIPT} --nf-config {DEFAULT_NF_CONFIG}  [OPTIONAL: --parameters-xml {PATH}]
```
Specifying the ```--parameters-xml``` parameter tells the ```nf-core.ica_mod_nf_script.R``` to generate an XML files based on the NF script and config you specify.
Default behavior is to traverse the config file you provide and parse additional config files that might be referenced.

A current list of todos for this script is [here](https://github.com/keng404/nextflow-to-icav2/blob/master/todos.nf_editing_for_icav2.md)
